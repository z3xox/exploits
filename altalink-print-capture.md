## Summary: 
> The "https://example.com/properties/security/network_troubleshooting_log.php" normally allows accounts with diagnostic privileges to access diagnostic features that allow them to find any problems related to ports such as HTTP, HTTPS and LDAP but an attacker could take advantage of this issue by customizing the port that the printer is listening to a printing port such as 9100 (Raw Printing), 631 (IPP) and 515 (LPR) which would enable the printer to capture all traffic of the given ports and store them to the machine internal storage for up to 48 hours. After capturing the data, the attacker simply downloads the pcap file and opens it in a network protocol analyzer program such as “WireShark” and listen to the TCP conversation and extracts them. Finally, using the extracted TCP conversation the attacker can use a tool which converts PostScript file to PDF such as “GhostScript” 

### Tested on Versions
*AltaLink C8035: 101.008.089.22600

*AltaLink C8045: 101.002.069.17810 & 101.002.009.15090

*AltaLink C8055: 103.002.000.06000 

*AltaLink C8135:  113.009.001.06011 

##### Please note that in older versions where diagnostic hardcoded credentials are implemented, it is possible for an attacker to access the diagnostic account and create and administrator account that can take advantage of this vulnerability. 

### Proof of Concpet

Login to the printer using a high privilege authenticated account. 
![alta_link_logging](https://github.com/z3xox/exploits/blob/main/images/alta_logging_in.PNG)

Go to the vulnerable end point “/properties/security/network_troubleshooting_log.php” 
![alta_path](https://github.com/z3xox/exploits/blob/main/images/alta_path.PNG)

Increase the packet size to  “20000” and add a new port to listen to 
![alta_packet](https://github.com/z3xox/exploits/blob/main/images/alta_packet.PNG)

Use the used printing protocol depending on the organization and an understandable service name and save the port filter.
![alta_add_port](https://github.com/z3xox/exploits/blob/main/images/alta_add_port.PNG)


Start capturing the network traffic by clicking on the green start button.

![alta_start_listen](https://github.com/z3xox/exploits/blob/main/images/alta_start_listen.PNG)

After printing a paper, waiting for the allocated time to finish or the data reaches 10 MB the capture should be done and the attacker will be able to download the pcap file using the “Download Log Now” button
![alta_download](https://github.com/z3xox/exploits/blob/main/images/alta_download.PNG)

Open the downloaded pcap file within “Wireshark” and right-click any of the TCP packets and go to “Follow > TCP Stream” 
![alta_tcp_stream](https://github.com/z3xox/exploits/blob/main/images/alta_tcp_stream.png)

If the print job was using PCLXL then export the “TCP Stream” as RAW
![alta_check_language](https://github.com/z3xox/exploits/blob/main/images/alta_check_language.png)

![alta_save_file](https://github.com/z3xox/exploits/blob/main/images/alta_save_file.PNG)


Next use GhostPCL either in Windows or Linux to convert the data to a PDF format
![alta_use_ghostpcl](https://github.com/z3xox/exploits/blob/main/images/alta_use_ghostpcl.PNG)

Otherwise, If the print job is in PostScript then simply use GhostScript to just translate it to PDF by saving the “TCP Stream” as “ASCII” then delete all the lines containing @PJL XCPT

![alta_postscript](https://github.com/z3xox/exploits/blob/main/images/alta_postscript.PNG)
![alta_delete](https://github.com/z3xox/exploits/blob/main/images/alta_delete.PNG)
![alta_delete_result](https://github.com/z3xox/exploits/blob/main/images/alta_delete_result.PNG)

Finally, simply drag the file from the file browser into the ghost script window and the PostScript file should be translated into PDF as seen below. 

![alta_drag](https://github.com/z3xox/exploits/blob/main/images/alta_drag.PNG)
